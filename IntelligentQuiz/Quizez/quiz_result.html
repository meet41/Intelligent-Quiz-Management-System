{% extends 'base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="text-align: center; margin-bottom: 3rem;">
        <h2 style="font-size: 2rem; margin-bottom: 1rem;">{{ attempt.quiz.title }}</h2>

        {% with percentage=attempt.score %}
        <div style="margin: 2rem 0;">
            <div style="width: 140px; height: 140px; border-radius: 50%; border: 8px solid {% if percentage >= 80 %}var(--success){% elif percentage >= 60 %}#f59e0b{% else %}var(--danger){% endif %}; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 700;">
                {{ percentage }}%
            </div>
            <div style="margin-top: .75rem; color: var(--text); opacity: .8;">
                Correct: <strong>{{ correct_count }}</strong> / {{ attempt.total }}
            </div>
            <div style="margin-top: .25rem; color: var(--text); opacity: .8;">
                Time taken: <strong>{{ time_taken_display }}</strong>
            </div>

            <p style="font-size: 1.25rem; margin-top: 1rem;">
                {% if percentage >= 80 %}
                    <span style="color: var(--success)">Excellent!</span>
                {% elif percentage >= 60 %}
                    <span style="color: #f59e0b">Good effort!</span>
                {% else %}
                    <span style="color: var(--danger)">Keep practicing!</span>
                {% endif %}
            </p>
        </div>
        {% endwith %}
    </div>

    <details style="margin-bottom: 2rem;">
    <summary style="padding: 1rem; background: var(--bg-card); border-radius: var(--radius); cursor: pointer; user-select: none;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span style="font-weight: 500;">Review Answers</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transform: rotate(0deg); transition: transform 0.3s;">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
            </div>
        </summary>
        
        <div style="margin-top: 1rem;">
            {% for a in answers %}
                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <span style="background: var(--bg); color: var(--text); width: 2rem; height: 2rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; flex-shrink: 0;">
                            {{ forloop.counter }}
                        </span>
                        <div style="font-weight: 500;">{{ a.question.text }}</div>
                    </div>

                    <div style="margin-left: 3rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <span style="color: var(--text); opacity: 0.7;">Your answer:</span>
                            {% if a.is_correct %}
                            <div style="padding: 0.75rem; border-radius: var(--radius); margin-top: 0.5rem; background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.35);">
                                {% if a.selected_choice %}
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2">
                                            <path d="M20 6L9 17l-5-5"/>
                                        </svg>
                                        {{ a.selected_choice.text }}
                                    </div>
                                {% else %}
                                    <em>No answer selected</em>
                                {% endif %}
                            </div>
                            {% else %}
                            <div style="padding: 0.75rem; border-radius: var(--radius); margin-top: 0.5rem; background: rgba(239,68,68,0.12); border: 1px solid rgba(239,68,68,0.35);">
                                {% if a.selected_choice %}
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--danger)" stroke-width="2">
                                            <path d="M18 6L6 18M6 6l12 12"/>
                                        </svg>
                                        {{ a.selected_choice.text }}
                                    </div>
                                {% else %}
                                    <em>No answer selected</em>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>

                        {% if not a.is_correct %}
                            <div>
                                <span style="color: var(--text); opacity: 0.7;">Correct answer:</span>
                                <div style="padding: 0.75rem; background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.35); border-radius: var(--radius); margin-top: 0.5rem;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2">
                                            <path d="M20 6L9 17l-5-5"/>
                                        </svg>
                                        {{ a.question.correct_choice.text }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </details>

    <div style="display: flex; gap: 1rem; justify-content: center;">
        <a href="{% url 'quiz_session' attempt.quiz.id %}" class="btn" style="background: var(--text);">
            Try Again
        </a>
        <a href="{% url 'quiz_list' %}" class="btn">
            More Quizzes
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const details = document.querySelector('details');
        const arrow = details.querySelector('svg');
        
        details.addEventListener('toggle', function() {
            if (this.open) {
                arrow.style.transform = 'rotate(180deg)';
            } else {
                arrow.style.transform = 'rotate(0deg)';
            }
        });
    });
</script>
{% endblock %}
